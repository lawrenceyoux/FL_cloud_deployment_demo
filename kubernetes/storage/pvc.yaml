# kubernetes/storage/pvc.yaml
# PersistentVolumeClaims for stateful components in the mlops namespace.
#
# NOTE: PostgreSQL storage is provisioned automatically via the StatefulSet's
#       volumeClaimTemplates in postgres.yaml (no manual PVC needed for Postgres).
#
# NOTE: MLflow artifacts are stored in S3 (fl-demo-mlflow bucket) â€” no PVC required
#       for the MLflow server either.
#
# This file is kept as a reference / override template that can be applied if you
# want to attach extra persistent storage to any pod (e.g. a staging area for large
# model checkpoints before they are pushed to S3).
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mlflow-staging-pvc
  namespace: mlops
  labels:
    app: mlflow-server
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: gp3        # EKS default gp3 StorageClass provided by EBS CSI driver
  resources:
    requests:
      storage: 20Gi
---
# Additional PVC example: shared scratch space for FL training jobs
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: fl-scratch-pvc
  namespace: federated-learning
  labels:
    component: fl-training
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: gp3
  resources:
    requests:
      storage: 10Gi
